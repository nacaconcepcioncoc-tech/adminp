{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KRES Admin - Payments</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'DM Sans',sans-serif; background:#f5f5f5; display:flex; min-height:100vh; }
        .sidebar { width:310px; background:linear-gradient(180deg,#4a6a82,#3d5773); color:white; display:flex; flex-direction:column; position:fixed; height:100vh; }
        .logo-section { display:flex; align-items:center; padding:25px 20px; gap:18px; border-bottom:1px solid rgba(255,255,255,.15); }
        .logo { flex-shrink:0; width:55px; height:55px; border-radius:50%; background:rgba(255,255,255,.95); display:flex; align-items:center; justify-content:center; }
        .logo img { width:50px; height:50px; border-radius:50%; object-fit:contain; padding:5px; }
        .logo-text h1 { font-size:20px; font-weight:700; letter-spacing:.5px; }
        .logo-text p { font-size:12px; color:#d0dce8; }
        .nav-menu { flex:1; padding:10px; overflow-y:auto; margin-top:40px; }
        .nav-item { display:flex; align-items:center; gap:15px; padding:15px 20px; color:#b8c9d9; text-decoration:none; border-radius:8px; margin-bottom:5px; transition:all .3s; font-size:15px; }
        .nav-item:hover { background:rgba(255,255,255,.1); color:white; }
        .nav-item.active { background:white; color:#2c4456; }
        .nav-item svg { width:24px; height:24px; flex-shrink:0; }
        .user-profile { display:flex; align-items:center; gap:12px; padding:20px; border-top:1px solid rgba(255,255,255,.1); margin-top:auto; }
        .avatar { width:42px; height:42px; background:#5d7a8f; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:18px; font-weight:600; }
        .user-name { font-size:14px; font-weight:600; flex:1; }
        .logout-icon { width:24px; height:24px; color:#b8c9d9; cursor:pointer; transition:color .3s; }
        .logout-icon:hover { color:white; }
        .main-content { margin-left:310px; flex:1; background:#f5f5f5; min-height:100vh; }
        .header { background:white; padding:25px 35px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 1px 3px rgba(0,0,0,.05); }
        .header-left { display:flex; align-items:center; gap:15px; }
        .header-left svg { width:24px; height:24px; color:#333; }
        .header h2 { font-size:28px; font-weight:600; color:#1a1a1a; }
        .notification-icon { position:relative; cursor:pointer; padding:8px; }
        .notification-icon svg { width:28px; height:28px; color:#1a1a1a; }
        .notification-badge { position:absolute; top:2px; right:2px; background:#ef4444; color:white; width:20px; height:20px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:700; }
        .page-content { padding:30px 35px; }

        /* Summary Cards */
        .summary-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:28px; }
        .summary-card { background:white; border-radius:12px; padding:22px 24px; box-shadow:0 1px 3px rgba(0,0,0,.08); transition:all .3s; text-decoration:none; display:block; cursor:pointer; }
        .summary-card:hover { transform:translateY(-3px); box-shadow:0 6px 16px rgba(0,0,0,.1); }
        .summary-card h4 { font-size:12px; font-weight:600; color:#6b7280; text-transform:uppercase; letter-spacing:.6px; margin-bottom:12px; }
        .summary-card .val { font-size:28px; font-weight:700; color:#1a1a1a; }
        .summary-card .val.green { color:#059669; }

        /* Table */
        .content-card { background:white; border-radius:12px; padding:24px; box-shadow:0 1px 3px rgba(0,0,0,.08); }
        .content-card h3 { font-size:18px; font-weight:700; color:#1a1a1a; margin-bottom:20px; }
        .payment-table { width:100%; border-collapse:collapse; }
        .payment-table thead { background:#f9fafb; }
        .payment-table th { padding:14px 16px; text-align:left; font-size:12px; font-weight:600; color:#6b7280; text-transform:uppercase; letter-spacing:.5px; border-bottom:2px solid #e5e7eb; }
        .payment-table td { padding:16px; border-bottom:1px solid #f0f0f0; color:#374151; font-size:14px; }
        .payment-table tbody tr:hover { background:#f9fafb; }
        .payment-table tbody tr:last-child td { border-bottom:none; }
        .status-badge { display:inline-block; padding:5px 12px; border-radius:20px; font-size:12px; font-weight:600; }
        .st-completed { background:#dcfce7; color:#16a34a; }
        .st-pending { background:#fef3c7; color:#d97706; }
        .st-failed { background:#fee2e2; color:#dc2626; }
        .method-badge { display:inline-flex; align-items:center; gap:5px; padding:5px 10px; border-radius:6px; font-size:13px; font-weight:600; }
        .m-gcash { background:#e0f2fe; color:#0369a1; }
        .m-cash { background:#dcfce7; color:#16a34a; }
        .m-bank { background:#f3e8ff; color:#7c3aed; }
        .empty-msg { text-align:center; padding:50px; color:#9ca3af; }
        .notification-dropdown { position:absolute; top:60px; right:20px; background:white; border:1px solid #e0e0e0; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.1); width:300px; max-height:400px; overflow-y:auto; z-index:1000; display:none; }
        .notification-dropdown.show { display:block; }
        .notification-header { padding:15px; border-bottom:1px solid #e0e0e0; font-weight:600; color:#1a1a1a; }
        .notification-item { padding:12px 15px; border-bottom:1px solid #f0f0f0; cursor:pointer; }
        .notification-item:hover { background:#f5f5f5; }
        .notification-item-title { font-weight:600; color:#1a1a1a; margin-bottom:4px; }
        .notification-item-text { font-size:12px; color:#666; }
        .notification-footer { padding:10px 15px; text-align:center; border-top:1px solid #e0e0e0; color:#3d5a73; font-size:13px; font-weight:600; }
    </style>
</head>
<body>
<div class="sidebar">
    <div class="logo-section">
        <div class="logo"><img src="{% static 'images/logo.png' %}" alt="KRES Logo"></div>
        <div class="logo-text"><h1>KRES Admin</h1><p>Management Panel</p></div>
    </div>
    <nav class="nav-menu">
        <a href="{% url 'pages:dashboard' %}" class="nav-item"><svg viewBox="0 0 24 24" fill="none"><rect x="3" y="3" width="7" height="7" rx="1" fill="currentColor"/><rect x="14" y="3" width="7" height="7" rx="1" fill="currentColor"/><rect x="3" y="14" width="7" height="7" rx="1" fill="currentColor"/><rect x="14" y="14" width="7" height="7" rx="1" fill="currentColor"/></svg><span>Dashboard</span></a>
        <a href="{% url 'pages:inventory' %}" class="nav-item"><svg viewBox="0 0 24 24" fill="none"><path d="M20 7H4C2.9 7 2 7.9 2 9V19C2 20.1 2.9 21 4 21H20C21.1 21 22 20.1 22 19V9C22 7.9 21.1 7 20 7Z" stroke="currentColor" stroke-width="2"/><path d="M12 7V3M8 7V5M16 7V5" stroke="currentColor" stroke-width="2"/></svg><span>Inventory</span></a>
        <a href="{% url 'pages:orders' %}" class="nav-item"><svg viewBox="0 0 24 24" fill="none"><path d="M9 2L7 6H3L8 10L6 14L12 11L18 14L16 10L21 6H17L15 2H9Z" stroke="currentColor" stroke-width="2"/><path d="M6 14L4 22H20L18 14" stroke="currentColor" stroke-width="2"/></svg><span>Orders</span></a>
        <a href="{% url 'pages:customers' %}" class="nav-item"><svg viewBox="0 0 24 24" fill="none"><circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/><circle cx="17" cy="10" r="3" stroke="currentColor" stroke-width="2"/><path d="M2 20C2 16.5 5 14 9 14C13 14 16 16.5 16 20" stroke="currentColor" stroke-width="2"/><path d="M13 20C13 17.5 15 16 17 16C19 16 22 17.5 22 20" stroke="currentColor" stroke-width="2"/></svg><span>Customers</span></a>
        <a href="{% url 'pages:payments' %}" class="nav-item active"><svg viewBox="0 0 24 24" fill="none"><rect x="2" y="4" width="20" height="16" rx="2" stroke="currentColor" stroke-width="2"/><path d="M2 10H22M6 14H10M6 17H8" stroke="currentColor" stroke-width="2"/></svg><span>Payments</span></a>
        <a href="{% url 'pages:reports' %}" class="nav-item"><svg viewBox="0 0 24 24" fill="none"><rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/><path d="M8 2V6M16 2V6M3 10H21" stroke="currentColor" stroke-width="2"/><circle cx="8" cy="14" r="1" fill="currentColor"/><circle cx="12" cy="14" r="1" fill="currentColor"/><circle cx="16" cy="14" r="1" fill="currentColor"/><circle cx="8" cy="18" r="1" fill="currentColor"/><circle cx="12" cy="18" r="1" fill="currentColor"/></svg><span>Reports</span></a>
    </nav>
    <div class="user-profile">
        <div class="avatar">A</div>
        <div class="user-name">Admin User</div>
        <a href="{% url 'pages:logout' %}" onclick="return confirm('Logout?');" style="text-decoration:none;display:flex;">
            <svg class="logout-icon" viewBox="0 0 24 24" fill="none"><path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9M16 17L21 12M21 12L16 7M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </a>
    </div>
</div>

<div class="main-content">
    <header class="header">
        <div class="header-left">
            <svg viewBox="0 0 24 24" fill="none"><path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            <h2>Payments</h2>
        </div>
        <div class="notification-icon" onclick="toggleNotifications(event)">
            <svg viewBox="0 0 24 24" fill="none"><path d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 21 3 24 3 24H21C21 24 18 21 18 8Z" fill="currentColor"/><path d="M14.73 21H9.27" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            {% with total=low_stock_count|add:pending_payments|add:new_customers_count %}{% if total > 0 %}<span class="notification-badge">{{ total }}</span>{% endif %}{% endwith %}
            <div id="notificationDropdown" class="notification-dropdown">
                <div class="notification-header">Notifications</div>
                {% if new_customers_count > 0 %}<a href="{% url 'pages:customers' %}" style="text-decoration:none;color:inherit;"><div class="notification-item"><div class="notification-item-title">üë• New Customers</div><div class="notification-item-text">{{ new_customers_count }} new customer(s) today</div></div></a>{% endif %}
                {% if low_stock_count > 0 %}<a href="{% url 'pages:inventory' %}" style="text-decoration:none;color:inherit;"><div class="notification-item"><div class="notification-item-title">‚ö†Ô∏è Low Stock Alert</div><div class="notification-item-text">{{ low_stock_count }} product(s) running low</div></div></a>{% endif %}
                {% if pending_payments > 0 %}<a href="#transactions-table" style="text-decoration:none;color:inherit;"><div class="notification-item"><div class="notification-item-title">üí≥ Pending Payments</div><div class="notification-item-text">{{ pending_payments }} payment(s) waiting</div></div></a>{% endif %}
                {% with total=low_stock_count|add:pending_payments|add:new_customers_count %}
                    <div class="notification-footer">{% if total == 0 %}No new notifications{% else %}All notifications{% endif %}</div>
                {% endwith %}
            </div>
        </div>
    </header>

    <div class="page-content">
        <!-- Summary Cards -->
        <div class="summary-grid">
            <a href="#transactions-table" class="summary-card">
                <h4>Total Revenue</h4>
                <div class="val green">‚Ç± {{ total_revenue|floatformat:2 }}</div>
            </a>
            <a href="#transactions-table" class="summary-card">
                <h4>Down Payment / Unpaid</h4>
                <div class="val">{{ pending_payments_count }}</div>
            </a>
            <a href="{% url 'pages:customers' %}" class="summary-card">
                <h4>Customers Transacted</h4>
                <div class="val">{{ customers_transacted }}</div>
            </a>
            <a href="{% url 'pages:orders' %}" class="summary-card">
                <h4>Orders Completed</h4>
                <div class="val">{{ orders_completed }}</div>
            </a>
        </div>

        <!-- Transactions Table -->
        <div class="content-card" id="transactions-table">
            <h3>Recent Payment Transactions</h3>
            <table class="payment-table">
                <thead>
                    <tr>
                        <th>Customer Name</th>
                        <th>Order ID</th>
                        <th>Amount</th>
                        <th>Payment Method</th>
                        <th>Status</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for payment in payments %}
                    <tr>
                        <td style="font-weight:600;color:#1a1a1a;">{{ payment.order.customer.first_name }} {{ payment.order.customer.last_name }}</td>
                        <td style="font-family:monospace;font-size:13px;">{{ payment.order.order_number }}</td>
                        <td style="font-weight:700;">‚Ç± {{ payment.amount|floatformat:2 }}</td>
                        <td>
                            {% if payment.payment_method == 'gcash' %}<span class="method-badge m-gcash"> GCash</span>
                            {% elif payment.payment_method == 'cash' %}<span class="method-badge m-cash"> Cash</span>
                            {% elif payment.payment_method == 'bank_transfer' %}<span class="method-badge m-bank"> Bank Transfer</span>
                            {% else %}<span class="method-badge m-cash">{{ payment.payment_method }}</span>{% endif %}
                        </td>
                        <td>
                            {% if payment.payment_status == 'completed' %}<span class="status-badge st-completed">‚úÖ Fully Paid</span>
                            {% elif payment.payment_status == 'pending' %}<span class="status-badge st-pending">üí∞ Down Payment</span>
                            {% else %}<span class="status-badge st-failed">‚ùå Failed</span>{% endif %}
                        </td>
                        <td>{{ payment.payment_date|date:"M d, Y" }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="6" class="empty-msg">
                        <div style="font-size:36px;margin-bottom:8px;">üí≥</div>
                        <div style="font-size:15px;font-weight:600;color:#6b7280;">No transactions yet</div>
                        <div style="font-size:13px;margin-top:4px;">Payments will appear here when orders are created.</div>
                    </td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
function toggleNotifications(event) {
    event.stopPropagation();
    document.getElementById('notificationDropdown').classList.toggle('show');
}
document.addEventListener('click', function(e) {
    const icon = document.querySelector('.notification-icon');
    if (icon && !icon.contains(e.target)) {
        const dd = document.getElementById('notificationDropdown');
        if (dd) dd.classList.remove('show');
    }
});
</script>
</body>
</html>